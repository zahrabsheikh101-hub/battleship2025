# This program is commented by :
# YP - Yana Patel (21205694)
# ZS - Zahra Sheikh (21191679)
# BM - Bana Maarouf (21221998)

# --- Import needed data libraries ---
import csv # Used for reading/writing CSV files (not used yet here, but likely later in the game)

#start of Yana's Comments
# --- Function definition for generateStartMap ---
# Will take in the size of the map to be made and produce an empty starting map for the game.
# size = how many rows and columns the map should have (ex: 10x10)
def generateStartMap(size):
    startingMap = [] # this will become our 2D grid YP
    # loop for each row
    for counter in range(size):
        currentLine = [] # one row of the map YP

        # loop for each column in that row YP
        for counter in range(size):
            currentLine.append("~") # "~" represents empty water YP
        startingMap.append(currentLine) #add the completed row to the map

    return startingMap #return the finished 2D list

# --- Function definition for shotToNumbers ---
# Will take in a string of a letter and number and return a list of two numbers. YP
# Example: "A5" becomes [5, 0] (row 5, column 0) YP
def shotToNumbers(coordinateString, headingsList): 
    shotList = []

    #get the row number (the number part of the input) YP
    shotList.append(int(coordinateString[1]))

    # Find the column index by matching the letter YP
    for column in headingsList:
        if coordinateString[0] == column:
            shotList.append(headingsList.index(column))

    return shotList

# --- Function definition for checkHit ---
# Will take in shotCoordinateList and shipMap and return whether the shot hit or missed. YP
# Checks if a shot hits water or a ship YP
# shot = [row, column] YP
# map = the hidden ship map YP
def checkHit(shot, map):

    # Miss (empty ocean) YP
    if map[shot[0]][shot[1]] == "O":
        return ["X", "Miss!"]

    # battleship hit YP
    elif map[shot[0]][shot[1]] == "B":
        return ["B", "You hit the BATTLESHIP!"]

    # submarine hit YP
    elif map[shot[0]][shot[1]] == "S":
        return ["S", "You hit the SUBMARINE!"]

    # Destroyer hit YP
    elif map[shot[0]][shot[1]] == "D":
        return ["D", "You hit the DESTROYER!"]

    # Carrier hit YP
    elif map[shot[0]][shot[1]] == "C":
        return ["C", "You hit the CARRIER!"]

# --- Function definition for updateMap ---
# Takes in the current map and the last shot results and returns an updated map. YP
# lastShotCell = [row, col] YP
# lastShotResult = "X" (miss) or ship symbol YP
def updateMap(lastShotCell, lastShotResult, map):
    map[lastShotCell[0]][lastShotCell[1]] = lastShotResult # replace symbol at shot location
    return map

# --- Function definition for checkShipStatus ---
# Will check the ship layout to check which ships have been sunk. YP
# Returns a list of True/False values for each ship YP
def checkShipStatus(shipList, shipMap):
    shipStatus = []

    # Start by assuming all ships are not found YP
    for index in range(len(shipList)):
        shipStatus.append(False)

    #search the map for each ship symbol YP
    for index in range(len(shipList)):
        for list in shipMap:
            if shipList[index] in list:
                shipStatus[index] = True # ship still exists on the board YP
    return shipStatus
# --- Game variables ---
gridSize = 10 #10x10 board

# Valid row numbers as strings for user input YP
validRows = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"]

# Valid column letters for user input YP
validColumns = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J"]

# Ship symbols used on the hidden map YP
shipSymbols = ["B", "S", "D", "C"]

# Full ship names for messages YP
shipNames = ["BATTLESHIP", "SUBMARINE", "DESTROYER", "CARRIER"]
playing = True #controls the main game loop

# --- Welcome message and UX code ---
print("---------------------------\n"
      "        BATTLESHIPS\n"
      "---------------------------\n")

print("Welcome to Battleships Admiral!\n"
      "We've spotted an enemy fleet in our harbour and it's up to you to sink them!\n"
      "You'll need to hit the BATTLESHIP 4 times to get through the thick armour.\n"
      "There's a small DESTROYER that will take two hits, but be careful, it packs a punch!\n"
      "The CARRIER is the biggest ship, it will take five hits to destroy.\n"
      "Then there is a SUBMARINE that will need to be hit three times.\n\n"
      "Your navigator has been given a map of the seas. Fire your missiles into one of the coordinates on the map.\n"
      "Pick your shots carefully though as we have limited ammunition, if you run out they will sail away freely.\n"
      "It's all up to you now Admiral, GOOD LUCK!\n"
      "---------------------------\n")

# ----------- Starting the Game. Code will need to loop until the user quits. -----------
while playing:
    # --- Initializing the ship locations ---
    fileName = "battleshipMap.txt"      # Z.S. File that stores the preset ship positions. In our own game, we will create oru own files for our own game board.
    accessMode = "r"                    # Z.S. File access mode: read-only
    shipMap = []                        # Z.S. List that will hold ship layout from file


    try:
        # Z.S. Open the ship layout file and enter each row into shipMap
        with open(fileName, accessMode) as fileData:
            shipLocations = csv.reader(fileData)
            for row in shipLocations:
                shipMap.append(row)
    except FileNotFoundError:
        # Z.S. If map file cannot be found, an error message is shown
        print("Sorry, there was an error loading a required file.")

    # --- Difficulty select. Loop created to ensure valid input entered. ---
    while True:
        difficulty = input("What difficulty would you like to play? (easy/hard) ").lower()
        if difficulty == "easy":
            missileCount = 50  # Z.S. Easy mode gives the player 50 total missiles
            break
        elif difficulty == "hard":
            missileCount = 35  # Z.S. Hard mode gives the player 35 missiles to make the game more dofficult to win
            break # Z.S. There are two breaks here which is redundant. This will be corrected in oru own version of the game
            
            break
        else:
            print("Please enter a valid difficulty setting.") # Z.S. If invalid input is entered, an error message is shown


    # --- Variables to be set before each round ---
    currentMap = generateStartMap(gridSize) # Z.S. Creates empty map for user to start playing
    previousShots = [] # Z.S. List stores coordinates the user has aready targeted

    # ------ Starting the round. Code will need to loop until the user runs out of guesses or wins. ------
    while missileCount > 0:
        # --- Display currentMap to the user ---
        print("---------------------------")
        print("  " + " ".join(validColumns))  # Z.S. Prints the axis of the columns of the map labeled from A-J. I beleive this grid is too large, so in our version the grid wil be smaller
        for counter in range(gridSize):
            print(str(counter) + " " + " ".join(currentMap[counter])) # Z.S. Prints rows of the map 

        print("---------------------------\n"
              "MISSILES REMAINING: " + str(missileCount))

        # --- Get location input from the user for their shot ---
        while True:
            # Z.S. The loop will continue to prompt the user for a coordinate until the user enters an acceptable string
            userShot = input("Enter the coordinates you wish to shoot: ").upper()
            if len(userShot) != 2:
                # Z.S. Ensures the user enters a coorindate with the first character for the column and the second for the row
                print("Please enter a valid coordinate:")
            elif userShot in previousShots:
                # Z.S. Ensures the user does not repeat shots
                print("You've already shot there, pick a different coordinate.")
            elif userShot[0] not in validColumns or userShot[1] not in validRows:
                # Z.S. Ensures the user does not enter a coorindate outside of the grid (e.g. Z100)
                print("Please choose a coordinate in range.")
            else:
                # Z.S. If none of the above conditions are fullfilled, the user will have entered an acceptable answer and the loop will break
                previousShots.append(userShot) # Z.S. The coorindates entered will be added to the list of shots the user has made
                shotCoordinateList = shotToNumbers(userShot, validColumns) 
                break
#zahra will comment up to here
        print("---------------------------")

        #BM: Check if the shot is a hit or miss
        shotResult = checkHit(shotCoordinateList, shipMap)
        print(shotResult[1])

        # --- Update the  game map to refer to when checking ship status ---
        #BM: Update the enemy map to show that this location was fired at.
        #BM: The spot is marked with an so future checks know that this location has been fired at.
        shipMap = updateMap(shotCoordinateList, "X", shipMap)

        # - Check the status of the ships to check win condition -
        #BM: shipsStillAlive is a list that contains booleans for each ship
        # BM: "True"  indicates that the ship still has at least one segment remaining
        # BM: "False" implies that ship has completely sunk

        shipsStillAlive = checkShipStatus(shipSymbols, shipMap)
        #BM: Loop through the ships and announce which are alive or sunk

        for index in range(len(shipsStillAlive)):
            if shipsStillAlive[index]:
                print("The " + shipNames[index] + " still sails!")
            else:
                print("You have sunk the " + shipNames[index] + "!")

        # --- Update currentMap ---
        #BM: Update the player's map (currentMap) ---
        #BM: shotResult[0] contains the symbol "X" for hit, "O" for miss
        #BM: currentMap is the map that the player currently sees on screen

        currentMap = updateMap(shotCoordinateList, shotResult[0], currentMap)

        # - Check win condition. If not ships remain end the game. ---
        #BM: if no ship is alive anymore (no True values left), the game is over

        if True not in shipsStillAlive:
            print("Good shooting! You have destroyed the enemy fleet!")
            break #BM: exit the loop
 
        # - Check lose condition. Modify the missile count then check if the user has shots remaining. 

        #BM: Each turn, the player uses one missile.
        #BM: If the missile count reaches zero, the player cannot shoot anymore â†’ game lost
        missileCount -= 1
        if missileCount == 0:
            print("Looks like the enemy fleet has escaped the harbour! You had better get your crew in order Admiral!")

        # ------ End of the Round. ------
    print("---------------------------")

    #BM: ask the player if they would like to play again
    userContinue = input("Would you like to play again? (Y/N) ").upper()
    while True: 
        if userContinue == "Y":
            playing = True #BM: restarts the main game loop 
            break
        elif userContinue == "N":
            playing = False #BM: ends the program after the loop finishes
            break
        else:
            print("Unknown inout, please enter Y or N")

    # ----------- End of the Game. -----------

print("\nThanks for playing!")
